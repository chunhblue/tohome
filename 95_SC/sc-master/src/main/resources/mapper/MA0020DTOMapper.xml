<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.com.bbut.iy.itemmaster.dao.MA0020DTOMapper" >
    <resultMap id="BaseResultMap" type="cn.com.bbut.iy.itemmaster.dto.ma0020.MA0020DTO" >
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="structure_level" property="structureLevel" jdbcType="CHAR" />
        <id column="structure_cd" property="structureCd" jdbcType="CHAR" />
        <result column="structure_name" property="structureName" jdbcType="VARCHAR" />
        <result column="admin_structure_cd" property="adminStructureCd" jdbcType="CHAR" />
        <result column="effective_sts" property="effectiveSts" jdbcType="CHAR" />
        <result column="create_user_id" property="createUserId" jdbcType="VARCHAR" />
        <result column="create_ymd" property="createYmd" jdbcType="CHAR" />
        <result column="create_hms" property="createHms" jdbcType="CHAR" />
        <result column="update_user_id" property="updateUserId" jdbcType="VARCHAR" />
        <result column="update_ymd" property="updateYmd" jdbcType="CHAR" />
        <result column="update_hms" property="updateHms" jdbcType="CHAR" />
        <result column="update_screen_id" property="updateScreenId" jdbcType="VARCHAR" />
        <result column="update_ip_address" property="updateIpAddress" jdbcType="VARCHAR" />
        <result column="nr_update_flg" property="nrUpdateFlg" jdbcType="CHAR" />
        <result column="nr_ymd" property="nrYmd" jdbcType="CHAR" />
        <result column="nr_hms" property="nrHms" jdbcType="CHAR" />
        <result column="level" property="Level" jdbcType="CHAR"/>
        <result column="admin_structure_name" property="adminStructureName" jdbcType="VARCHAR" />
    </resultMap>

    <sql id="Example_Where_Clause" >
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <where >
            <foreach collection="oredCriteria" item="criteria" separator="or" >
                <if test="criteria.valid" >
                    <trim prefix="(" suffix=")" prefixOverrides="and" >
                        <foreach collection="criteria.criteria" item="criterion" >
                            <choose >
                                <when test="criterion.noValue" >
                                    and ${criterion.condition}
                                </when>
                                <when test="criterion.singleValue" >
                                    and ${criterion.condition} #{criterion.value}
                                </when>
                                <when test="criterion.betweenValue" >
                                    and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                                </when>
                                <when test="criterion.listValue" >
                                    and ${criterion.condition}
                                    <foreach collection="criterion.value" item="listItem" open="(" close=")" separator="," >
                                        #{listItem}
                                    </foreach>
                                </when>
                            </choose>
                        </foreach>
                    </trim>
                </if>
            </foreach>
        </where>
    </sql>
    <sql id="Update_By_Example_Where_Clause" >
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <where >
            <foreach collection="example.oredCriteria" item="criteria" separator="or" >
                <if test="criteria.valid" >
                    <trim prefix="(" suffix=")" prefixOverrides="and" >
                        <foreach collection="criteria.criteria" item="criterion" >
                            <choose >
                                <when test="criterion.noValue" >
                                    and ${criterion.condition}
                                </when>
                                <when test="criterion.singleValue" >
                                    and ${criterion.condition} #{criterion.value}
                                </when>
                                <when test="criterion.betweenValue" >
                                    and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                                </when>
                                <when test="criterion.listValue" >
                                    and ${criterion.condition}
                                    <foreach collection="criterion.value" item="listItem" open="(" close=")" separator="," >
                                        #{listItem}
                                    </foreach>
                                </when>
                            </choose>
                        </foreach>
                    </trim>
                </if>
            </foreach>
        </where>
    </sql>
    <sql id="Base_Column_List" >
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        structure_level, structure_cd, structure_name, admin_structure_cd, effective_sts,
        create_user_id, create_ymd, create_hms, update_user_id, update_ymd, update_hms, update_screen_id,
        update_ip_address, nr_update_flg, nr_ymd, nr_hms
    </sql>
    <select id="selectByExample" resultMap="BaseResultMap" parameterType="cn.com.bbut.iy.itemmaster.entity.ma0020.MA0020CExample" >
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select
        <if test="needFoundRows" >
            SQL_CALC_FOUND_ROWS
        </if>
        <if test="distinct" >
            distinct
        </if>
        <include refid="Base_Column_List" />
        from ma0020
        <if test="_parameter != null" >
            <include refid="Example_Where_Clause" />
        </if>
        <if test="orderByClause != null" >
            order by ${orderByClause}
        </if>
        <if test="limitStart >= 0" >
            limit ${limitStart} , ${limitEnd}
        </if>
    </select>

    <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="cn.com.bbut.iy.itemmaster.entity.ma0020.MA0020CKey" >
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select
        <include refid="Base_Column_List" />
        from ma0020
        where structure_level = #{structureLevel,jdbcType=CHAR}
        and structure_cd = #{structureCd,jdbcType=CHAR}
    </select>

    <delete id="deleteByPrimaryKey" parameterType="cn.com.bbut.iy.itemmaster.entity.ma0020.MA0020CKey" >
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        delete from ma0020
        where structure_level = #{structureLevel,jdbcType=CHAR}
        and structure_cd = #{structureCd,jdbcType=CHAR}
    </delete>

    <delete id="deleteByExample" parameterType="cn.com.bbut.iy.itemmaster.entity.ma0020.MA0020CExample" >
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        delete from ma0020
        <if test="_parameter != null" >
            <include refid="Example_Where_Clause" />
        </if>
    </delete>

    <insert id="insert" parameterType="cn.com.bbut.iy.itemmaster.dto.ma0020.MA0020DTO" >
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into ma0020 (structure_level, structure_cd, structure_name,
        admin_structure_cd, effective_sts, create_user_id,
        create_ymd, create_hms, update_user_id,
        update_ymd, update_hms, update_screen_id,
        update_ip_address, nr_update_flg, nr_ymd,
        nr_hms)
        values (#{structureLevel,jdbcType=CHAR}, #{structureCd,jdbcType=CHAR}, #{structureName,jdbcType=VARCHAR},
        #{adminStructureCd,jdbcType=CHAR}, #{effectiveSts,jdbcType=CHAR}, #{createUserId,jdbcType=VARCHAR},
        #{createYmd,jdbcType=CHAR}, #{createHms,jdbcType=CHAR}, #{updateUserId,jdbcType=VARCHAR},
        #{updateYmd,jdbcType=CHAR}, #{updateHms,jdbcType=CHAR}, #{updateScreenId,jdbcType=VARCHAR},
        #{updateIpAddress,jdbcType=VARCHAR}, #{nrUpdateFlg,jdbcType=CHAR}, #{nrYmd,jdbcType=CHAR},
        #{nrHms,jdbcType=CHAR})
    </insert>

    <insert id="insertSelective" parameterType="cn.com.bbut.iy.itemmaster.dto.ma0020.MA0020DTO" >
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into ma0020
        <trim prefix="(" suffix=")" suffixOverrides="," >
            <if test="structureLevel != null" >
                structure_level,
            </if>
            <if test="structureCd != null" >
                structure_cd,
            </if>
            <if test="structureName != null" >
                structure_name,
            </if>
            <if test="adminStructureCd != null" >
                admin_structure_cd,
            </if>
            <if test="effectiveSts != null" >
                effective_sts,
            </if>
            <if test="createUserId != null" >
                create_user_id,
            </if>
            <if test="createYmd != null" >
                create_ymd,
            </if>
            <if test="createHms != null" >
                create_hms,
            </if>
            <if test="updateUserId != null" >
                update_user_id,
            </if>
            <if test="updateYmd != null" >
                update_ymd,
            </if>
            <if test="updateHms != null" >
                update_hms,
            </if>
            <if test="updateScreenId != null" >
                update_screen_id,
            </if>
            <if test="updateIpAddress != null" >
                update_ip_address,
            </if>
            <if test="nrUpdateFlg != null" >
                nr_update_flg,
            </if>
            <if test="nrYmd != null" >
                nr_ymd,
            </if>
            <if test="nrHms != null" >
                nr_hms,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides="," >
            <if test="structureLevel != null" >
                #{structureLevel,jdbcType=CHAR},
            </if>
            <if test="structureCd != null" >
                #{structureCd,jdbcType=CHAR},
            </if>
            <if test="structureName != null" >
                #{structureName,jdbcType=VARCHAR},
            </if>
            <if test="adminStructureCd != null" >
                #{adminStructureCd,jdbcType=CHAR},
            </if>
            <if test="effectiveSts != null" >
                #{effectiveSts,jdbcType=CHAR},
            </if>
            <if test="createUserId != null" >
                #{createUserId,jdbcType=VARCHAR},
            </if>
            <if test="createYmd != null" >
                #{createYmd,jdbcType=CHAR},
            </if>
            <if test="createHms != null" >
                #{createHms,jdbcType=CHAR},
            </if>
            <if test="updateUserId != null" >
                #{updateUserId,jdbcType=VARCHAR},
            </if>
            <if test="updateYmd != null" >
                #{updateYmd,jdbcType=CHAR},
            </if>
            <if test="updateHms != null" >
                #{updateHms,jdbcType=CHAR},
            </if>
            <if test="updateScreenId != null" >
                #{updateScreenId,jdbcType=VARCHAR},
            </if>
            <if test="updateIpAddress != null" >
                #{updateIpAddress,jdbcType=VARCHAR},
            </if>
            <if test="nrUpdateFlg != null" >
                #{nrUpdateFlg,jdbcType=CHAR},
            </if>
            <if test="nrYmd != null" >
                #{nrYmd,jdbcType=CHAR},
            </if>
            <if test="nrHms != null" >
                #{nrHms,jdbcType=CHAR},
            </if>
        </trim>
    </insert>

    <select id="countByExample" parameterType="cn.com.bbut.iy.itemmaster.entity.ma0020.MA0020CExample" resultType="java.lang.Integer" >
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select count(*) from ma0020
        <if test="_parameter != null" >
            <include refid="Example_Where_Clause" />
        </if>
    </select>

    <update id="updateByExampleSelective" parameterType="map" >
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update ma0020
        <set >
            <if test="record.structureLevel != null" >
                structure_level = #{record.structureLevel,jdbcType=CHAR},
            </if>
            <if test="record.structureCd != null" >
                structure_cd = #{record.structureCd,jdbcType=CHAR},
            </if>
            <if test="record.structureName != null" >
                structure_name = #{record.structureName,jdbcType=VARCHAR},
            </if>
            <if test="record.adminStructureCd != null" >
                admin_structure_cd = #{record.adminStructureCd,jdbcType=CHAR},
            </if>
            <if test="record.effectiveSts != null" >
                effective_sts = #{record.effectiveSts,jdbcType=CHAR},
            </if>
            <if test="record.createUserId != null" >
                create_user_id = #{record.createUserId,jdbcType=VARCHAR},
            </if>
            <if test="record.createYmd != null" >
                create_ymd = #{record.createYmd,jdbcType=CHAR},
            </if>
            <if test="record.createHms != null" >
                create_hms = #{record.createHms,jdbcType=CHAR},
            </if>
            <if test="record.updateUserId != null" >
                update_user_id = #{record.updateUserId,jdbcType=VARCHAR},
            </if>
            <if test="record.updateYmd != null" >
                update_ymd = #{record.updateYmd,jdbcType=CHAR},
            </if>
            <if test="record.updateHms != null" >
                update_hms = #{record.updateHms,jdbcType=CHAR},
            </if>
            <if test="record.updateScreenId != null" >
                update_screen_id = #{record.updateScreenId,jdbcType=VARCHAR},
            </if>
            <if test="record.updateIpAddress != null" >
                update_ip_address = #{record.updateIpAddress,jdbcType=VARCHAR},
            </if>
            <if test="record.nrUpdateFlg != null" >
                nr_update_flg = #{record.nrUpdateFlg,jdbcType=CHAR},
            </if>
            <if test="record.nrYmd != null" >
                nr_ymd = #{record.nrYmd,jdbcType=CHAR},
            </if>
            <if test="record.nrHms != null" >
                nr_hms = #{record.nrHms,jdbcType=CHAR},
            </if>
        </set>
        <if test="_parameter != null" >
            <include refid="Update_By_Example_Where_Clause" />
        </if>
    </update>

    <update id="updateByExample" parameterType="map" >
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update ma0020
        set structure_level = #{record.structureLevel,jdbcType=CHAR},
        structure_cd = #{record.structureCd,jdbcType=CHAR},
        structure_name = #{record.structureName,jdbcType=VARCHAR},
        admin_structure_cd = #{record.adminStructureCd,jdbcType=CHAR},
        effective_sts = #{record.effectiveSts,jdbcType=CHAR},
        create_user_id = #{record.createUserId,jdbcType=VARCHAR},
        create_ymd = #{record.createYmd,jdbcType=CHAR},
        create_hms = #{record.createHms,jdbcType=CHAR},
        update_user_id = #{record.updateUserId,jdbcType=VARCHAR},
        update_ymd = #{record.updateYmd,jdbcType=CHAR},
        update_hms = #{record.updateHms,jdbcType=CHAR},
        update_screen_id = #{record.updateScreenId,jdbcType=VARCHAR},
        update_ip_address = #{record.updateIpAddress,jdbcType=VARCHAR},
        nr_update_flg = #{record.nrUpdateFlg,jdbcType=CHAR},
        nr_ymd = #{record.nrYmd,jdbcType=CHAR},
        nr_hms = #{record.nrHms,jdbcType=CHAR}
        <if test="_parameter != null" >
            <include refid="Update_By_Example_Where_Clause" />
        </if>
    </update>

    <update id="updateByPrimaryKeySelective" parameterType="cn.com.bbut.iy.itemmaster.dto.ma0020.MA0020DTO" >
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update ma0020
        <set >
            <if test="structureName != null" >
                structure_name = #{structureName,jdbcType=VARCHAR},
            </if>
            <if test="adminStructureCd != null" >
                admin_structure_cd = #{adminStructureCd,jdbcType=CHAR},
            </if>
            <if test="effectiveSts != null" >
                effective_sts = #{effectiveSts,jdbcType=CHAR},
            </if>
            <if test="createUserId != null" >
                create_user_id = #{createUserId,jdbcType=VARCHAR},
            </if>
            <if test="createYmd != null" >
                create_ymd = #{createYmd,jdbcType=CHAR},
            </if>
            <if test="createHms != null" >
                create_hms = #{createHms,jdbcType=CHAR},
            </if>
            <if test="updateUserId != null" >
                update_user_id = #{updateUserId,jdbcType=VARCHAR},
            </if>
            <if test="updateYmd != null" >
                update_ymd = #{updateYmd,jdbcType=CHAR},
            </if>
            <if test="updateHms != null" >
                update_hms = #{updateHms,jdbcType=CHAR},
            </if>
            <if test="updateScreenId != null" >
                update_screen_id = #{updateScreenId,jdbcType=VARCHAR},
            </if>
            <if test="updateIpAddress != null" >
                update_ip_address = #{updateIpAddress,jdbcType=VARCHAR},
            </if>
            <if test="nrUpdateFlg != null" >
                nr_update_flg = #{nrUpdateFlg,jdbcType=CHAR},
            </if>
            <if test="nrYmd != null" >
                nr_ymd = #{nrYmd,jdbcType=CHAR},
            </if>
            <if test="nrHms != null" >
                nr_hms = #{nrHms,jdbcType=CHAR},
            </if>
        </set>
        where structure_level = #{structureLevel,jdbcType=CHAR}
        and structure_cd = #{structureCd,jdbcType=CHAR}
    </update>

    <update id="updateByPrimaryKey" parameterType="cn.com.bbut.iy.itemmaster.dto.ma0020.MA0020DTO" >
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update ma0020
        set structure_name = #{structureName,jdbcType=VARCHAR},
        admin_structure_cd = #{adminStructureCd,jdbcType=CHAR},
        effective_sts = #{effectiveSts,jdbcType=CHAR},
        create_user_id = #{createUserId,jdbcType=VARCHAR},
        create_ymd = #{createYmd,jdbcType=CHAR},
        create_hms = #{createHms,jdbcType=CHAR},
        update_user_id = #{updateUserId,jdbcType=VARCHAR},
        update_ymd = #{updateYmd,jdbcType=CHAR},
        update_hms = #{updateHms,jdbcType=CHAR},
        update_screen_id = #{updateScreenId,jdbcType=VARCHAR},
        update_ip_address = #{updateIpAddress,jdbcType=VARCHAR},
        nr_update_flg = #{nrUpdateFlg,jdbcType=CHAR},
        nr_ymd = #{nrYmd,jdbcType=CHAR},
        nr_hms = #{nrHms,jdbcType=CHAR}
        where structure_level = #{structureLevel,jdbcType=CHAR}
        and structure_cd = #{structureCd,jdbcType=CHAR}
    </update>

    <select id="countLastSelect" resultType="java.lang.Integer" >
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select FOUND_ROWS()
    </select>

    <select id="selectSameLevel" parameterType="java.lang.String" resultMap="BaseResultMap">
        SELECT structure_level,structure_cd, structure_name,  admin_structure_cd
        FROM MA0020
        WHERE
            admin_structure_cd = #{adminStructureCd, jdbcType=VARCHAR} AND
            structure_level = CAST(#{structureLevel, jdbcType=VARCHAR} AS VARCHAR)
    </select>

    <select id="selectParentMenus" parameterType="java.lang.String" resultMap="BaseResultMap">
        SELECT * FROM MA0020 WHERE structure_cd=#{structureCd,jdbcType=VARCHAR };
    </select>

    <select id="selectInformation" parameterType="java.lang.String" resultMap="BaseResultMap">
        select structure_level,structure_cd, structure_name, admin_structure_cd,effective_sts
        from ma0020 where structure_name=#{structureName,jdbcType=VARCHAR}
    </select>

    <select id="selectCountByCondition" parameterType="cn.com.bbut.iy.itemmaster.dto.ma0020.MA0020DTO" resultType="INT">
        SELECT COUNT(1) from ma0020;
    </select>

    <select id="selectDetailMa0020" parameterType="java.lang.String" resultMap="BaseResultMap">
        select structure_level,structure_cd, structure_name, admin_structure_cd,effective_sts
        from ma0020 where structure_cd = #{structureCd,jdbcType=VARCHAR}
    </select>

    <select id="selectListByCondition" parameterType="cn.com.bbut.iy.itemmaster.dto.ma0020.MA0020DTO" resultMap="BaseResultMap">
        SELECT
            T.*, T1.structure_name AS admin_structure_name
        FROM (
            select
                structure_level, structure_cd, admin_structure_cd, effective_sts,
                <choose>
                    <when test="structureCd!=null and structureCd!=''">
                        structure_name
                    </when>
                    <otherwise>
                        case when structure_level = '4' then concat(structure_cd,' ',structure_name)
                            else structure_name end as structure_name
                    </otherwise>
                </choose>
            from ma0020
            <where>
                <if test="structureCd!=null and structureCd!=''">
                    structure_cd = #{structureCd,jdbcType=VARCHAR}
                </if>
            </where>
        ) T
        LEFT JOIN (
            select structure_cd, structure_name from ma0020
        ) T1
        ON T.admin_structure_cd = T1.structure_cd
        ORDER BY T.structure_level, T.structure_cd
    </select>

    <select id="selectNationWideMa0020C" parameterType="cn.com.bbut.iy.itemmaster.dto.ma0020.MA0020DTO" resultMap="BaseResultMap">
        select structure_level,structure_cd, structure_name, admin_structure_cd,effective_sts
        from ma0020 where structure_name=#{structureName,jdbcType=VARCHAR};
    </select>

    <select id="getListStructName" resultType="cn.com.bbut.iy.itemmaster.dto.base.AutoCompleteDTO">
        select structure_cd k, structure_name  v from ma0020
    </select>

    <!-- 根据等级、父级ID查询 -->
<!--    <select id="selectListByLevel" resultType="cn.com.bbut.iy.itemmaster.dto.base.AutoCompleteDTO" parameterType="java.lang.String" >-->
<!--        SELECT-->
<!--            structure_cd k, CONCAT(structure_cd,' ',structure_name) AS v-->
<!--        FROM-->
<!--            MA0020-->
<!--        WHERE-->
<!--            effective_sts = '10'-->
<!--        <choose>-->
<!--            <when test="level=='0'.toString()">-->
<!--                AND level = '0'-->
<!--            </when>-->
<!--            <otherwise>-->
<!--                AND level = #{level,jdbcType=VARCHAR}-->
<!--                <choose>-->
<!--                    <when test="p=='000001'.toString()">-->
<!--                        AND admin_structure_cd IN (-->
<!--                            SELECT structure_cd FROM MA0020-->
<!--                            WHERE admin_structure_cd = #{p,jdbcType=VARCHAR}-->
<!--                        )-->
<!--                    </when>-->
<!--                    <otherwise>-->
<!--                        AND admin_structure_cd = #{p,jdbcType=VARCHAR}-->
<!--                    </otherwise>-->
<!--                </choose>-->
<!--            </otherwise>-->
<!--        </choose>-->
<!--        <if test="v!=null and v!=''">-->
<!--            AND (-->
<!--                lower(structure_cd) like lower(CONCAT('%',#{v,jdbcType=VARCHAR},'%'))-->
<!--                OR lower(structure_name) like lower(CONCAT('%',#{v,jdbcType=VARCHAR},'%'))-->
<!--            )-->
<!--        </if>-->
<!--        ORDER BY structure_cd-->
<!--    </select>-->
    <!-- 根据等级、父级ID查询 -->
<!--    8//20测试 添加英文名字-->
    <select id="selectStoreList" resultType="cn.com.bbut.iy.itemmaster.dto.base.AutoCompleteDTO" >
    SELECT
       MA0020.structure_cd k,   CONCAT( MA0020.structure_cd,' ',MA1000.store_name_en) AS v
       FROM
       MA0020,MA1000
       WHERE
      MA0020.structure_cd=MA1000.store_cd
       AND  MA0020.effective_sts = '10'
       AND level = '3'
       <choose>
           <when test="districtCd=='000001'.toString()">
               AND admin_structure_cd IN (
               SELECT structure_cd FROM MA0020
               WHERE admin_structure_cd = #{p,jdbcType=VARCHAR}
               )
           </when>
           <otherwise>
               AND admin_structure_cd = #{districtCd,jdbcType=VARCHAR}
           </otherwise>
       </choose>
       <if test="v!=null and v!=''">
           AND (
           lower(MA0020.structure_cd) like lower(CONCAT('%',#{v,jdbcType=VARCHAR},'%'))
           OR lower(structure_name) like lower(CONCAT('%',#{v,jdbcType=VARCHAR},'%'))
           OR LOWER(store_name_en) like lower(CONCAT('%',#{v,jdbcType=VARCHAR},'%'))
           )
       </if>
        <if test="storeCds!=null">
            and MA0020.structure_cd in
            <foreach item="storeCd" index="index" collection="storeCds"
                     open="(" separator="," close=")">
                #{storeCd,jdbcType=VARCHAR}
            </foreach>
        </if>
        ORDER BY MA0020.structure_cd
    </select>

    <select id="getStoreListByLevel" resultType="cn.com.bbut.iy.itemmaster.dto.base.AutoCompleteDTO" >
        SELECT
        MA0020.structure_cd k,
        CONCAT( MA0020.structure_cd,' ',MA1000.store_name_en) AS v
        FROM
        MA0020,MA1000
        WHERE
        MA0020.structure_cd=MA1000.store_cd
        AND  MA0020.effective_sts = '10'
        AND level = '3'
        AND admin_structure_cd IN (
        <choose>
            <when test="cityCd!=null">
                SELECT
                structure_cd
                FROM
                MA0020
                WHERE admin_structure_cd =#{cityCd,jdbcType=VARCHAR}
                AND LEVEL = '2' and effective_sts = '10'
            </when>
            <otherwise>
                <choose>
                    <when test="regionCd=='000001'.toString()">
                        SELECT
                        structure_cd
                        FROM
                        MA0020
                        WHERE admin_structure_cd in(SELECT structure_cd FROM MA0020
                        WHERE admin_structure_cd in (SELECT structure_cd FROM MA0020
                        WHERE LEVEL = '0' and effective_sts = '10'
                        ) and  LEVEL = '1' and effective_sts = '10'
                        ) AND LEVEL = '2' and effective_sts = '10'
                    </when>
                    <otherwise>
                        SELECT
                        structure_cd
                        FROM
                        MA0020
                        WHERE admin_structure_cd in(
                            SELECT structure_cd FROM MA0020
                            WHERE admin_structure_cd = #{regionCd,jdbcType=VARCHAR} and
                                LEVEL = '1' and effective_sts = '10'
                        ) AND LEVEL = '2' and effective_sts = '10'
                    </otherwise>
                </choose>
            </otherwise>
        </choose>
        )
        <if test="v!=null and v!=''">
            AND (
            lower(MA0020.structure_cd) like lower(CONCAT('%',#{v,jdbcType=VARCHAR},'%'))
            OR lower(structure_name) like lower(CONCAT('%',#{v,jdbcType=VARCHAR},'%'))
            OR LOWER(store_name_en) like lower(CONCAT('%',#{v,jdbcType=VARCHAR},'%'))
            )
        </if>
        <if test="storeCds!=null">
            and MA0020.structure_cd in
            <foreach item="storeCd" index="index" collection="storeCds"
                     open="(" separator="," close=")">
                #{storeCd,jdbcType=VARCHAR}
            </foreach>
        </if>
        ORDER BY MA0020.structure_cd
    </select>

    <select id="selectListByLevel" resultType="cn.com.bbut.iy.itemmaster.dto.base.AutoCompleteDTO" parameterType="java.lang.String" >
        SELECT
            structure_cd k,   CONCAT(structure_cd,' ',structure_name) AS v
            FROM
            MA0020
            WHERE
            effective_sts = '10'
            <choose>
                <when test="level=='0'.toString()">
                    AND level = '0'
                </when>
                <otherwise>
                    AND level = #{level,jdbcType=VARCHAR}
                    <choose>
                        <when test="p=='000001'.toString()">
                            AND admin_structure_cd IN (
                            SELECT structure_cd FROM MA0020
                            WHERE admin_structure_cd = #{p,jdbcType=VARCHAR}
                            )
                        </when>
                        <otherwise>
                            AND admin_structure_cd = #{p,jdbcType=VARCHAR}
                        </otherwise>
                    </choose>
                </otherwise>
            </choose>
            <if test="v!=null and v!=''">
                AND (
                lower(structure_cd) like lower(CONCAT('%',#{v,jdbcType=VARCHAR},'%'))
                OR lower(structure_name) like lower(CONCAT('%',#{v,jdbcType=VARCHAR},'%'))
                )
            </if>
            ORDER BY structure_cd
    </select>

    <select id="getDistrictList" resultType="cn.com.bbut.iy.itemmaster.dto.base.AutoCompleteDTO" parameterType="java.lang.String" >
        SELECT
        structure_cd k,   CONCAT(structure_cd,' ',structure_name) AS v
        FROM
        MA0020
        WHERE
        effective_sts = '10'
        AND level = #{level,jdbcType=VARCHAR}
        AND admin_structure_cd IN (
            SELECT structure_cd FROM ma0020 where admin_structure_cd IN(
        <choose>
            <when test="p=='000001'.toString()">
                SELECT structure_cd FROM MA0020
                WHERE admin_structure_cd = '000001'
            </when>
            <otherwise>
                #{p,jdbcType=VARCHAR}
            </otherwise>
        </choose>
                )
        AND LEVEL = '1' and effective_sts = '10' )
        <if test="v!=null and v!=''">
            AND (
            lower(structure_cd) like lower(CONCAT('%',#{v,jdbcType=VARCHAR},'%'))
            OR lower(structure_name) like lower(CONCAT('%',#{v,jdbcType=VARCHAR},'%'))
            )
        </if>
        ORDER BY structure_cd
    </select>

    <!-- 查询子级 -->
    <select id="selectChildrenByParent" resultType="java.lang.String" parameterType="java.lang.String" >
        SELECT
            structure_cd
        FROM
            MA0020
        WHERE effective_sts = '10'
        AND admin_structure_cd = #{parent,jdbcType=VARCHAR}
        ORDER BY structure_cd
    </select>

    <!-- 查询所有店铺 -->
    <select id="selectStoreByParent" resultType="java.lang.String" parameterType="java.lang.String" >
        SELECT
            structure_cd
        FROM
            MA0020
        WHERE effective_sts = '10'
        <choose>
            <when test="level=='0'.toString()">
                AND level = '3'
            </when>
            <when test="level > 1">
                AND admin_structure_cd IN (
                    SELECT structure_cd FROM MA0020
                    WHERE effective_sts = '10'
                <choose>
                    <when test="level > 2">
                        AND admin_structure_cd IN (
                            SELECT structure_cd FROM MA0020
                            WHERE effective_sts = '10'
                            AND admin_structure_cd = #{parent,jdbcType=VARCHAR}
                        )
                    </when>
                    <otherwise>
                        AND admin_structure_cd = #{parent,jdbcType=VARCHAR}
                    </otherwise>
                </choose>
                )
            </when>
            <otherwise>
                AND admin_structure_cd = #{parent,jdbcType=VARCHAR}
            </otherwise>
        </choose>

        <if test="storeCds!=null">
            and structure_cd in
            <foreach item="storeCd" index="index" collection="storeCds"
                     open="(" separator="," close=")">
                #{storeCd,jdbcType=VARCHAR}
            </foreach>
        </if>
        ORDER BY structure_cd
    </select>

    <select id="getData" resultMap="BaseResultMap">
        select * from ma0020
        LIMIT ${param.rows} OFFSET ${param.limitStart}
    </select>

    <select id="getDataCount"  parameterType="cn.com.bbut.iy.itemmaster.dto.ma0020.Ma0020ParamDTO"  resultType="INT" >
        select COUNT(ma0020.structure_cd)
        from ma0020
    </select>

    <!-- 查询待选 -->
    <select id="selectAllStore" resultType="cn.com.bbut.iy.itemmaster.dto.base.AutoCompleteDTO">
        SELECT ma0020.structure_cd k, CONCAT(ma0020.structure_cd,' ',ma1000.store_name_en) AS v
        FROM MA0020,ma1000
        WHERE effective_sts = '10'
        AND level = '3'
        AND  MA0020.structure_cd=ma1000.store_cd
        AND  MA0020.structure_cd IN
        <foreach item="store" index="index" collection="stores"
                 open="(" separator="," close=")">
            #{store,jdbcType=VARCHAR}
        </foreach>
        <if test="v!=null and v!=''">
            AND (
                lower(MA0020.structure_cd) like lower(CONCAT('%',#{v,jdbcType=VARCHAR},'%'))
                OR lower(structure_name) like lower(CONCAT('%',#{v,jdbcType=VARCHAR},'%'))
                OR lower(ma1000.store_name_en) like lower(CONCAT('%',#{v,jdbcType=VARCHAR},'%'))
            )
        </if>
    </select>
</mapper>